var WL=(()=>{var ye=Object.defineProperty;var pe=(_,e)=>{for(var t in e)ye(_,t,{get:e[t],enumerable:!0})};var ue=(_,e,t)=>{if(!e.has(_))throw TypeError("Cannot "+t)};var F=(_,e,t)=>(ue(_,e,"read from private field"),t?t.call(_):e.get(_)),me=(_,e,t)=>{if(e.has(_))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(_):e.set(_,t)},Z=(_,e,t,n)=>(ue(_,e,"write to private field"),n?n.call(_,t):e.set(_,t),t);var I=(_,e,t)=>new Promise((n,r)=>{var o=a=>{try{i(t.next(a))}catch(l){r(l)}},s=a=>{try{i(t.throw(a))}catch(l){r(l)}},i=a=>a.done?n(a.value):Promise.resolve(a.value).then(o,s);i((t=t.apply(_,e)).next())});var Ae={};pe(Ae,{Alignment:()=>Q,Animation:()=>C,AnimationComponent:()=>k,AnimationState:()=>ee,Collider:()=>Y,CollisionComponent:()=>P,CollisionEventType:()=>te,Component:()=>g,ForceMode:()=>U,InputComponent:()=>W,InputType:()=>x,Justification:()=>J,LightComponent:()=>L,LightType:()=>K,Material:()=>j,MaterialParamType:()=>b,Mesh:()=>A,MeshAttribute:()=>p,MeshAttributeAccessor:()=>ne,MeshComponent:()=>D,MeshIndexType:()=>w,Object:()=>h,PhysXComponent:()=>S,Physics:()=>$,RayHit:()=>B,Scene:()=>X,Shape:()=>T,Skin:()=>E,TextComponent:()=>N,TextEffect:()=>q,Texture:()=>M,Type:()=>u,ViewComponent:()=>v,WASM:()=>_e,WonderlandEngine:()=>ae,loadRuntime:()=>Ce,math:()=>de});var he=()=>I(void 0,null,function*(){return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]))});var ge=()=>(_=>I(void 0,null,function*(){try{return typeof MessageChannel!="undefined"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(_)}catch(e){return!1}}))(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]));var le={};pe(le,{Alignment:()=>Q,Animation:()=>C,AnimationComponent:()=>k,AnimationState:()=>ee,Collider:()=>Y,CollisionComponent:()=>P,CollisionEventType:()=>te,Component:()=>g,ForceMode:()=>U,InputComponent:()=>W,InputType:()=>x,Justification:()=>J,LightComponent:()=>L,LightType:()=>K,Material:()=>j,MaterialParamType:()=>b,Mesh:()=>A,MeshAttribute:()=>p,MeshAttributeAccessor:()=>ne,MeshComponent:()=>D,MeshIndexType:()=>w,Object:()=>h,PhysXComponent:()=>S,Physics:()=>$,RayHit:()=>B,Scene:()=>X,Shape:()=>T,Skin:()=>E,TextComponent:()=>N,TextEffect:()=>q,Texture:()=>M,Type:()=>u,ViewComponent:()=>v,math:()=>de});function R(_){return _===""?!0:_&&(typeof _=="string"||_.constructor===String)}var we="Misaligned pointer: please report a bug",fe=["_id","_manager","type","_type","active"],u;(function(m){m[m.Bool=2]="Bool",m[m.Int=4]="Int",m[m.Float=8]="Float",m[m.String=16]="String",m[m.Enum=32]="Enum",m[m.Object=64]="Object",m[m.Mesh=128]="Mesh",m[m.Texture=256]="Texture",m[m.Material=512]="Material",m[m.Animation=1024]="Animation",m[m.Skin=2048]="Skin"})(u||(u={}));var Y;(function(n){n[n.Sphere=0]="Sphere",n[n.AxisAlignedBox=1]="AxisAlignedBox",n[n.Box=2]="Box"})(Y||(Y={}));var Q;(function(n){n[n.Left=1]="Left",n[n.Center=2]="Center",n[n.Right=3]="Right"})(Q||(Q={}));var J;(function(r){r[r.Line=1]="Line",r[r.Middle=2]="Middle",r[r.Top=3]="Top",r[r.Bottom=4]="Bottom"})(J||(J={}));var q;(function(t){t[t.None=0]="None",t[t.Outline=1]="Outline"})(q||(q={}));var x;(function(i){i[i.Head=0]="Head",i[i.EyeLeft=1]="EyeLeft",i[i.EyeRight=2]="EyeRight",i[i.ControllerLeft=3]="ControllerLeft",i[i.ControllerRight=4]="ControllerRight",i[i.RayLeft=5]="RayLeft",i[i.RayRight=6]="RayRight"})(x||(x={}));var K;(function(n){n[n.Point=1]="Point",n[n.Spot=2]="Spot",n[n.Sun=3]="Sun"})(K||(K={}));var ee;(function(n){n[n.Playing=1]="Playing",n[n.Paused=2]="Paused",n[n.Stopped=3]="Stopped"})(ee||(ee={}));var U;(function(r){r[r.Force=0]="Force",r[r.Impulse=1]="Impulse",r[r.VelocityChange=2]="VelocityChange",r[r.Acceleration=3]="Acceleration"})(U||(U={}));var te;(function(r){r[r.Touch=0]="Touch",r[r.TouchLost=1]="TouchLost",r[r.TriggerTouch=2]="TriggerTouch",r[r.TriggerTouchLost=3]="TriggerTouchLost"})(te||(te={}));var T;(function(i){i[i.None=0]="None",i[i.Sphere=1]="Sphere",i[i.Capsule=2]="Capsule",i[i.Box=3]="Box",i[i.Plane=4]="Plane",i[i.ConvexMesh=5]="ConvexMesh",i[i.TriangleMesh=6]="TriangleMesh"})(T||(T={}));var p;(function(l){l[l.Position=0]="Position",l[l.Tangent=1]="Tangent",l[l.Normal=2]="Normal",l[l.TextureCoordinate=3]="TextureCoordinate",l[l.Color=4]="Color",l[l.JointId=5]="JointId",l[l.JointWeight=6]="JointWeight",l[l.SecondaryJointId=7]="SecondaryJointId",l[l.SecondaryJointWeight=8]="SecondaryJointWeight"})(p||(p={}));var b;(function(o){o[o.UnsignedInt=0]="UnsignedInt",o[o.Int=1]="Int",o[o.Float=2]="Float",o[o.Sampler=3]="Sampler",o[o.Font=4]="Font"})(b||(b={}));var xe=[0,1,0],X=class{constructor(e){this._engine=e,this._rayHit=_malloc(4*(3*4+3*4+4+2)+4),this._hit=new B(this._engine,this._rayHit),this.onPreRender=[],this.onPostRender=[]}get activeViews(){let e=_wl_scene_get_active_views(this._engine.wasm._tempMem,16),t=[],n=h._typeIndexFor("view");for(let r=0;r<e;++r)t.push(new v(this._engine,n,this._engine.wasm._tempMemInt[r]));return t}rayCast(e,t,n){return _wl_scene_ray_cast(e[0],e[1],e[2],t[0],t[1],t[2],n,this._rayHit),this._hit}addObject(e){let t=e?e.objectId:0,n=_wl_scene_add_object(t);return this._engine.wrapObject(n)}addObjects(e,t,n){let r=t?t.objectId:0;this._engine.wasm.requireTempMem(e*2);let o=_wl_scene_add_objects(r,e,n||0,this._engine.wasm._tempMem,this._engine.wasm._tempMemSize>>1),s=this._engine.wasm._tempMemUint16.subarray(0,o),i=this._engine.wrapObject.bind(this._engine);return Array.from(s,i)}reserveObjects(e,t){t=t||{};let n=h._typeIndexFor("js"),r=this._engine.wasm._tempMemInt.subarray();r.fill(0);for(let o of Object.entries(t)){let s=h._typeIndexFor(o[0]);r[s<0?n:s]+=o[1]}_wl_scene_reserve_objects(e,this._engine.wasm._tempMem)}set clearColor(e){_wl_scene_set_clearColor(e[0],e[1],e[2],e[3])}set colorClearEnabled(e){_wl_scene_enableColorClear(e)}load(e){let t=lengthBytesUTF8(e)+1,n=_malloc(t);stringToUTF8(e,n,t),_wl_load_scene(n),_free(n)}append(e,t){t=t||{};let n=!!t.loadGltfExtensions,r=lengthBytesUTF8(e)+1,o=_malloc(r);stringToUTF8(e,o,r);let s=this._engine.wasm._sceneLoadedCallback.length,i=new Promise((a,l)=>{this._engine.wasm._sceneLoadedCallback[s]={success:(c,m)=>{let d=this._engine.wrapObject(c);a(m?{root:d,extensions:m}:d)},error:()=>l()}});return _wl_append_scene(o,n,s),_free(o),i}_unmarshallGltfExtensions(e){let t={root:{},mesh:{},node:{},idMapping:{}},n=0,r=()=>{let c=e[n++],m=e[n++];return this._engine.wasm.UTF8ViewToString(c,c+m)},o=e[n++],s=new Array(o);for(let c=0;c<o;++c)s[c]=e[n++];t.idMapping=s;let i=e[n++];for(let c=0;c<i;++c){let m=e[n++];t.mesh[s[m]]=JSON.parse(r())}let a=e[n++];for(let c=0;c<a;++c){let m=e[n++];t.node[s[m]]=JSON.parse(r())}let l=r();return l&&(t.root=JSON.parse(l)),t}reset(){_wl_scene_reset()}},g=class{constructor(e,t=-1,n=-1){this._engine=e,this._manager=t,this._id=n,this._object=null,this._type=null}get engine(){return this._engine}get type(){return this._type||h._typeNameFor(this._manager)}get object(){if(!this._object){let e=_wl_component_get_object(this._manager,this._id);this._object=this._engine.wrapObject(e)}return this._object}set active(e){_wl_component_setActive(this._manager,this._id,e)}get active(){return _wl_component_isActive(this._manager,this._id)!=0}destroy(){_wl_component_remove(this._manager,this._id),this._manager=void 0,this._id=void 0}equals(e){return e?this._manager==e._manager&&this._id==e._id:!1}},ce=class extends g{get collider(){return _wl_collision_component_get_collider(this._id)}set collider(e){_wl_collision_component_set_collider(this._id,e)}get extents(){return new Float32Array(HEAPF32.buffer,_wl_collision_component_get_extents(this._id),3)}set extents(e){this.extents.set(e)}get group(){return _wl_collision_component_get_group(this._id)}set group(e){_wl_collision_component_set_group(this._id,e)}queryOverlaps(){let e=_wl_collision_component_query_overlaps(this._id,this._engine.wasm._tempMem,this._engine.wasm._tempMemSize>>1),t=new Array(e);for(let n=0;n<e;++n)t[n]=new ce(this._engine,this._manager,this._engine.wasm._tempMemUint16[n]);return t}},P=ce;P.TypeName="collision";var N=class extends g{get alignment(){return _wl_text_component_get_horizontal_alignment(this._id)}set alignment(e){_wl_text_component_set_horizontal_alignment(this._id,e)}get justification(){return _wl_text_component_get_vertical_alignment(this._id)}set justification(e){_wl_text_component_set_vertical_alignment(this._id,e)}get characterSpacing(){return _wl_text_component_get_character_spacing(this._id)}set characterSpacing(e){_wl_text_component_set_character_spacing(this._id,e)}get lineSpacing(){return _wl_text_component_get_line_spacing(this._id)}set lineSpacing(e){_wl_text_component_set_line_spacing(this._id,e)}get effect(){return _wl_text_component_get_effect(this._id)}set effect(e){_wl_text_component_set_effect(this._id,e)}get text(){return UTF8ToString(_wl_text_component_get_text(this._id))}set text(e){let t=lengthBytesUTF8(e)+1,n=_malloc(t);stringToUTF8(e,n,t),_wl_text_component_set_text(this._id,n),_free(n)}set material(e){let t=e?e._index:0;_wl_text_component_set_material(this._id,t)}get material(){let e=_wl_text_component_get_material(this._id);return e>0?new j(this._engine,e):null}};N.TypeName="text";var v=class extends g{get projectionMatrix(){return new Float32Array(HEAPF32.buffer,_wl_view_component_get_projection_matrix(this._id),16)}get near(){return _wl_view_component_get_near(this._id)}set near(e){_wl_view_component_set_near(this._id,e)}get far(){return _wl_view_component_get_far(this._id)}set far(e){_wl_view_component_set_far(this._id,e)}get fov(){return _wl_view_component_get_fov(this._id)}set fov(e){_wl_view_component_set_fov(this._id,e)}};v.TypeName="view";var W=class extends g{get inputType(){return _wl_input_component_get_type(this._id)}set inputType(e){_wl_input_component_set_type(this._id,e)}get xrInputSource(){let e=this._engine.xrSession;if(e){for(let t of e.inputSources)if(t.handedness==this.handedness)return t}return null}get handedness(){let e=this.inputType;return e==4||e==6||e==2?"right":e==3||e==5||e==1?"left":null}};W.TypeName="input";var L=class extends g{get color(){return new Float32Array(HEAPF32.buffer,_wl_light_component_get_color(this._id),4)}get lightType(){return _wl_light_component_get_type(this._id)}set lightType(e){_wl_light_component_set_type(this._id,e)}};L.TypeName="light";var k=class extends g{set animation(e){_wl_animation_component_set_animation(this._id,e._index)}get animation(){return new C(_wl_animation_component_get_animation(this._id))}set playCount(e){_wl_animation_component_set_playCount(this._id,e)}get playCount(){return _wl_animation_component_get_playCount(this._id)}set speed(e){_wl_animation_component_set_speed(this._id,e)}get speed(){return _wl_animation_component_get_speed(this._id)}get state(){return _wl_animation_component_state(this._id)}play(){_wl_animation_component_play(this._id)}stop(){_wl_animation_component_stop(this._id)}pause(){_wl_animation_component_pause(this._id)}};k.TypeName="animation";var D=class extends g{set material(e){_wl_mesh_component_set_material(this._id,e?e._index:0)}get material(){let e=_wl_mesh_component_get_material(this._id);return e>0?new j(this._engine,e):null}get mesh(){let e=_wl_mesh_component_get_mesh(this._id);return e>0?new A(e):null}set mesh(e){_wl_mesh_component_set_mesh(this._id,e?e._index:0)}get skin(){let e=_wl_mesh_component_get_skin(this._id);return e>0?new E(e):null}set skin(e){_wl_mesh_component_set_skin(this._id,e?e._index:0)}};D.TypeName="mesh";var S=class extends g{set static(e){_wl_physx_component_set_static(this._id,e)}get static(){return!!_wl_physx_component_get_static(this._id)}set kinematic(e){_wl_physx_component_set_kinematic(this._id,e)}get kinematic(){return!!_wl_physx_component_get_kinematic(this._id)}set gravity(e){_wl_physx_component_set_gravity(this._id,e)}get gravity(){return!!_wl_physx_component_get_gravity(this._id)}set simulate(e){_wl_physx_component_set_simulate(this._id,e)}get simulate(){return!!_wl_physx_component_get_simulate(this._id)}set allowSimulation(e){_wl_physx_component_set_allowSimulation(this._id,e)}get allowSimulation(){return!!_wl_physx_component_get_allowSimulation(this._id)}set allowQuery(e){_wl_physx_component_set_allowQuery(this._id,e)}get allowQuery(){return!!_wl_physx_component_get_allowQuery(this._id)}set trigger(e){_wl_physx_component_set_trigger(this._id,e)}get trigger(){return!!_wl_physx_component_get_trigger(this._id)}set shape(e){_wl_physx_component_set_shape(this._id,e)}get shape(){return _wl_physx_component_get_shape(this._id)}set shapeData(e){e==null||![6,5].includes(this.shape)||_wl_physx_component_set_shape_data(this._id,e.index)}get shapeData(){return[6,5].includes(this.shape)?{index:_wl_physx_component_get_shape_data(this._id)}:null}set extents(e){this.extents.set(e)}get extents(){let e=_wl_physx_component_get_extents(this._id);return new Float32Array(HEAPF32.buffer,e,3)}get staticFriction(){return _wl_physx_component_get_staticFriction(this._id)}set staticFriction(e){_wl_physx_component_set_staticFriction(this._id,e)}get dynamicFriction(){return _wl_physx_component_get_dynamicFriction(this._id)}set dynamicFriction(e){_wl_physx_component_set_dynamicFriction(this._id,e)}get bounciness(){return _wl_physx_component_get_bounciness(this._id)}set bounciness(e){_wl_physx_component_set_bounciness(this._id,e)}get linearDamping(){return _wl_physx_component_get_linearDamping(this._id)}set linearDamping(e){_wl_physx_component_set_linearDamping(this._id,e)}get angularDamping(){return _wl_physx_component_get_angularDamping(this._id)}set angularDamping(e){_wl_physx_component_set_angularDamping(this._id,e)}set linearVelocity(e){_wl_physx_component_set_linearVelocity(this._id,e[0],e[1],e[2])}get linearVelocity(){return _wl_physx_component_get_linearVelocity(this._id,this._engine.wasm._tempMem),new Float32Array(HEAPF32.buffer,this._engine.wasm._tempMem,3)}set angularVelocity(e){_wl_physx_component_set_angularVelocity(this._id,e[0],e[1],e[2])}get angularVelocity(){return _wl_physx_component_get_angularVelocity(this._id,this._engine.wasm._tempMem),new Float32Array(HEAPF32.buffer,this._engine.wasm._tempMem,3)}set mass(e){_wl_physx_component_set_mass(this._id,e)}get mass(){return _wl_physx_component_get_mass(this._id)}set massSpaceInteriaTensor(e){_wl_physx_component_set_massSpaceInertiaTensor(this._id,e[0],e[1],e[2])}addForce(e,t,n,r,o){t=t||0,r?_wl_physx_component_addForceAt(this._id,e[0],e[1],e[2],t,!!n,r[0],r[1],r[2],!!o):_wl_physx_component_addForce(this._id,e[0],e[1],e[2],t,!!n)}addTorque(e,t=0){_wl_physx_component_addTorque(this._id,e[0],e[1],e[2],t)}onCollision(e){return this.onCollisionWith(this,e)}onCollisionWith(e,t){let n=this._engine.physics;return n._callbacks[this._id]=n._callbacks[this._id]||[],n._callbacks[this._id].push(t),_wl_physx_component_addCallback(this._id,e._id||this._id)}removeCollisionCallback(e){let t=this._engine.physics,n=_wl_physx_component_removeCallback(this._id,e);n&&t._callbacks[this._id].splice(-n)}};S.TypeName="physx";for(let _ of["static","extents","staticFriction","dynamicFriction","bounciness","linearDamping","angularDamping","shape","shapeData","kinematic","linearVelocity","angularVelocity","mass"])Object.defineProperty(S.prototype,_,{enumerable:!0});var $=class{constructor(e){this._engine=e,this._rayHit=_malloc(4*(3*4+3*4+4+2)+4),this._hit=new B(this._engine,this._rayHit),this._callbacks={}}rayCast(e,t,n,r){return typeof r=="undefined"&&(r=100),_wl_physx_ray_cast(e[0],e[1],e[2],t[0],t[1],t[2],n,r||100,this._rayHit),this._hit}},w;(function(n){n[n.UnsignedByte=1]="UnsignedByte",n[n.UnsignedShort=2]="UnsignedShort",n[n.UnsignedInt=4]="UnsignedInt"})(w||(w={}));var A=class{static get VERTEX_FLOAT_SIZE(){return 3+3+2}static get VERTEX_SIZE(){return this.VERTEX_FLOAT_SIZE*4}static get POS(){return{X:0,Y:1,Z:2}}static get TEXCOORD(){return{U:3,V:4}}static get NORMAL(){return{X:5,Y:6,Z:7}}constructor(e,t=WL){if(this._engine=t,typeof e=="object"){if(!e.vertexCount&&e.vertexData&&(e.vertexCount=e.vertexData.length/A.VERTEX_FLOAT_SIZE),!e.vertexCount)throw new Error("Missing parameter 'vertexCount'");let n=0,r=0,o=0;if(e.indexData)switch(r=e.indexType||2,o=e.indexData.length*r,n=_malloc(o),r){case 1:HEAPU8.set(e.indexData,n);break;case 2:HEAPU16.set(e.indexData,n>>1);break;case 4:HEAPU32.set(e.indexData,n>>2);break}let{skinned:s=!1}=e;if(this._index=_wl_mesh_create(n,o,r,e.vertexCount,s),e.vertexData){let i=this.attribute(0),a=this.attribute(2),l=this.attribute(3);for(let c=0;c<e.vertexCount;++c){let m=c*A.VERTEX_FLOAT_SIZE;i.set(c,e.vertexData.subarray(m,m+3)),l==null||l.set(c,e.vertexData.subarray(m+3,m+5)),a==null||a.set(c,e.vertexData.subarray(m+5,m+8))}}}else this._index=e}get vertexData(){let e=_wl_mesh_get_vertexData(this._index,this._engine.wasm._tempMem);return new Float32Array(HEAPF32.buffer,e,A.VERTEX_FLOAT_SIZE*HEAPU32[this._engine.wasm._tempMem/4])}get vertexCount(){return _wl_mesh_get_vertexCount(this._index)}get indexData(){let e=this._engine.wasm._tempMem,t=_wl_mesh_get_indexData(this._index,e,e+4);if(t===null)return null;let n=HEAPU32[e/4];switch(HEAPU32[e/4+1]){case 1:return new Uint8Array(HEAPU8.buffer,t,n);case 2:return new Uint16Array(HEAPU16.buffer,t,n);case 4:return new Uint32Array(HEAPU32.buffer,t,n)}return null}update(){_wl_mesh_update(this._index)}getBoundingSphere(e=new Float32Array(4)){let t=this._engine.wasm._tempMemFloat;return _wl_mesh_get_boundingSphere(this._index,this._engine.wasm._tempMem),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}attribute(e){if(typeof e!="number")throw new TypeError("Expected number, but got "+typeof e);let t=this._engine.wasm._tempMemUint32;if(_wl_mesh_get_attribute(this._index,e,this._engine.wasm._tempMem),t[0]==255)return null;let n=new ne(this._engine,e);n._attribute=t[0],n._offset=t[1],n._stride=t[2],n._formatSize=t[3],n._componentCount=t[4];let r=t[5];return n._arraySize=r||1,n.length=this.vertexCount,n}destroy(){_wl_mesh_destroy(this._index)}},ne=class{constructor(e,t=0){this._attribute=-1;this._offset=0;this._stride=0;this._formatSize=0;this._componentCount=0;this._arraySize=1;this.length=0;this._engine=e;let n=this._engine.wasm;switch(t){case 0:case 2:case 3:case 1:case 4:case 6:this._bufferType=Float32Array,this._tempBufferGetter=n.getTempBufferF32.bind(n);break;case 5:this._bufferType=Uint16Array,this._tempBufferGetter=n.getTempBufferU16.bind(n);break;case 8:case 7:console.error(`Deprecated attribute accessor type: ${t}`);default:throw new Error(`Invalid attribute accessor type: ${t}`)}}createArray(e=1){return e=e>this.length?this.length:e,new this._bufferType(e*this._componentCount*this._arraySize)}get(e,t=this.createArray()){if(t.length%this._componentCount!=0)throw new Error(`out.length, ${t.length} is not a multiple of the attribute vector components, ${this._componentCount}`);let n=this._tempBufferGetter(t.length),r=this._bufferType.BYTES_PER_ELEMENT,o=r*t.length,s=this._formatSize*this._arraySize,i=this._componentCount*r*this._arraySize;_wl_mesh_get_attribute_values(this._attribute,s,this._offset+e*this._stride,this._stride,i,n.byteOffset,o);for(let a=0;a<t.length;++a)t[a]=n[a];return t}set(e,t){if(t.length%this._componentCount!=0)throw new Error(`out.length, ${t.length} is not a multiple of the attribute vector components, ${this._componentCount}`);let n=this._bufferType.BYTES_PER_ELEMENT,r=n*t.length,o=this._componentCount*n*this._arraySize,s=this._formatSize*this._arraySize;if(t.buffer!=HEAPU8.buffer){let i=this._tempBufferGetter(t.length);i.set(t),t=i}return _wl_mesh_set_attribute_values(this._attribute,o,t.byteOffset,r,s,this._offset+e*this._stride,this._stride),this}},j=class{constructor(e,t){if(this._engine=e,typeof t!="number"){if(!(t==null?void 0:t.pipeline))throw new Error("Missing parameter 'pipeline'");let n=t.pipeline,r=lengthBytesUTF8(n)+1;if(stringToUTF8(n,this._engine.wasm._tempMem,r),this._index=_wl_material_create(this._engine.wasm._tempMem),this._index<0)throw new Error(`No such pipeline '${n}'`)}else this._index=t;if(this._definition=_wl_material_get_definition(this._index),!this._engine.wasm._materialDefinitions[this._definition])throw new Error(`Material Definition ${this._definition} not found for material with index ${this._index}`);return new Proxy(this,{get(n,r){let o=e.wasm,i=o._materialDefinitions[n._definition].get(r);if(!i)return n[r];if(_wl_material_get_param_value(n._index,i.index,o._tempMem)){let a=i.type;switch(a.type){case 0:return a.componentCount==1?o._tempMemUint32[0]:new Uint32Array(HEAPU32.buffer,o._tempMem,a.componentCount);case 1:return a.componentCount==1?o._tempMemInt[0]:new Int32Array(HEAP32.buffer,o._tempMem,a.componentCount);case 2:return a.componentCount==1?o._tempMemFloat[0]:new Float32Array(HEAPF32.buffer,o._tempMem,a.componentCount);case 3:return new M(o._tempMemInt[0]);default:throw new Error(`Invalid type ${a} on parameter ${i.index} for material ${n._index}`)}}},set(n,r,o){let s=e.wasm,a=s._materialDefinitions[n._definition].get(r);if(!a)return n[r]=o,!0;switch(a.type.type){case 0:case 1:case 3:let c=o instanceof M?o.id:o;_wl_material_set_param_value_uint(n._index,a.index,c);break;case 2:let m=1;if(typeof o=="number")s._tempMemFloat[0]=o;else{m=o.length;for(let d=0;d<m;++d)s._tempMemFloat[d]=o[d]}_wl_material_set_param_value_float(n._index,a.index,s._tempMem,m);break;case 4:throw new Error("Setting font properties is currently unsupported.")}return!0}})}get shader(){return UTF8ToString(_wl_material_get_shader(this._index))}clone(){let e=_wl_material_clone(this._index);return e>0?new j(this._engine,e):null}static wrap(e,t){return t>0?new j(e,t):null}},O=null,M=class{constructor(e,t=WL){this._id=0;this._imageIndex=void 0;this._engine=t;let n=t.wasm;if(e instanceof HTMLImageElement||e instanceof HTMLVideoElement||e instanceof HTMLCanvasElement){let r=n._images.length;n._images.push(e),this._imageIndex=r,this._id=_wl_renderer_addImage(r)}else this._id=e;this._engine.textures[this._id]=this}get valid(){return this._id>=0}get id(){return this._id}update(){!this.valid||_wl_renderer_updateImage(this._id,this._imageIndex)}get width(){return _wl_texture_width(this._id)}get height(){return _wl_texture_height(this._id)}updateSubImage(e,t,n,r){var i;if(!this.valid)return;O||(O=document.createElement("canvas"));let o=this._engine.wasm,s=o._images[this._imageIndex];if(!!s){O.width=n,O.height=r,(i=O.getContext("2d"))==null||i.drawImage(s,e,t,n,r,0,0,n,r),o._images[this._imageIndex]=O;try{_wl_renderer_updateImage(this._id,this._imageIndex,e,(s.videoHeight||s.height)-t-r)}finally{o._images[this._imageIndex]=s}}}destroy(){_wl_texture_destroy(this._id),this._imageIndex&&(this._engine.wasm._images[this._imageIndex]=null,this._imageIndex=void 0)}},C=class{constructor(e){this._index=e}get duration(){return _wl_animation_get_duration(this._index)}get trackCount(){return _wl_animation_get_trackCount(this._index)}retarget(e){if(e instanceof E){let r=_wl_animation_retargetToSkin(this._index,e._index);return new C(r)}if(e.length!=this.trackCount)throw Error("Expected "+this.trackCount.toString()+" targets, but got "+e.length.toString());let t=_malloc(2*e.length);for(let r=0;r<e.length;++r)HEAPU16[t>>1+r]=e[r].objectId;let n=_wl_animation_retarget(this._index,t);return _free(t),new C(n)}},h=class{constructor(e,t){this.objectId=t,this._engine=e}get name(){return UTF8ToString(_wl_object_name(this.objectId))}set name(e){let t=lengthBytesUTF8(e)+1,n=_malloc(t);stringToUTF8(e,n,t),_wl_object_set_name(this.objectId,n),_free(n)}get parent(){let e=_wl_object_parent(this.objectId);return e===0?null:this._engine.wrapObject(e)}get children(){let e=_wl_object_get_children_count(this.objectId);if(e===0)return[];let t=this._engine.wasm;t.requireTempMem(e*2),_wl_object_get_children(this.objectId,t._tempMem,t._tempMemSize>>1);let n=new Array(e);for(let r=0;r<e;++r)n[r]=this._engine.wrapObject(t._tempMemUint16[r]);return n}set parent(e){_wl_object_set_parent(this.objectId,e==null?0:e.objectId)}resetTransform(){_wl_object_reset_translation_rotation(this.objectId),_wl_object_reset_scaling(this.objectId)}resetTranslationRotation(){_wl_object_reset_translation_rotation(this.objectId)}resetRotation(){_wl_object_reset_rotation(this.objectId)}resetTranslation(){_wl_object_reset_translation(this.objectId)}resetScaling(){_wl_object_reset_scaling(this.objectId)}translate(e){_wl_object_translate(this.objectId,e[0],e[1],e[2])}translateObject(e){_wl_object_translate_obj(this.objectId,e[0],e[1],e[2])}translateWorld(e){_wl_object_translate_world(this.objectId,e[0],e[1],e[2])}rotateAxisAngleDeg(e,t){_wl_object_rotate_axis_angle(this.objectId,e[0],e[1],e[2],t)}rotateAxisAngleRad(e,t){_wl_object_rotate_axis_angle_rad(this.objectId,e[0],e[1],e[2],t)}rotateAxisAngleDegObject(e,t){_wl_object_rotate_axis_angle_obj(this.objectId,e[0],e[1],e[2],t)}rotateAxisAngleRadObject(e,t){_wl_object_rotate_axis_angle_rad_obj(this.objectId,e[0],e[1],e[2],t)}rotate(e){_wl_object_rotate_quat(this.objectId,e[0],e[1],e[2],e[3])}rotateObject(e){_wl_object_rotate_quat_obj(this.objectId,e[0],e[1],e[2],e[3])}scale(e){_wl_object_scale(this.objectId,e[0],e[1],e[2])}get transformLocal(){return new Float32Array(HEAPF32.buffer,_wl_object_trans_local(this.objectId),8)}set transformLocal(e){this.transformLocal.set(e),this.setDirty()}getTranslationLocal(e){let t=this._engine.wasm;return _wl_object_get_translation_local(this.objectId,t._tempMem),e[0]=t._tempMemFloat[0],e[1]=t._tempMemFloat[1],e[2]=t._tempMemFloat[2],e}getTranslationWorld(e){let t=this._engine.wasm;return _wl_object_get_translation_world(this.objectId,t._tempMem),e[0]=t._tempMemFloat[0],e[1]=t._tempMemFloat[1],e[2]=t._tempMemFloat[2],e}setTranslationLocal(e){_wl_object_set_translation_local(this.objectId,e[0],e[1],e[2])}setTranslationWorld(e){_wl_object_set_translation_world(this.objectId,e[0],e[1],e[2])}get transformWorld(){return new Float32Array(HEAPF32.buffer,_wl_object_trans_world(this.objectId),8)}set transformWorld(e){this.transformWorld.set(e),_wl_object_trans_world_to_local(this.objectId)}get scalingLocal(){return new Float32Array(HEAPF32.buffer,_wl_object_scaling_local(this.objectId),3)}set scalingLocal(e){this.scalingLocal.set(e),this.setDirty()}get scalingWorld(){return new Float32Array(HEAPF32.buffer,_wl_object_scaling_world(this.objectId),3)}set scalingWorld(e){this.scalingWorld.set(e),_wl_object_scaling_world_to_local(this.objectId)}get rotationLocal(){return this.transformLocal.subarray(0,4)}get rotationWorld(){return this.transformWorld.subarray(0,4)}set rotationLocal(e){_wl_object_set_rotation_local(this.objectId,e[0],e[1],e[2],e[3])}set rotationWorld(e){_wl_object_set_rotation_world(this.objectId,e[0],e[1],e[2],e[3])}getForward(e){return e[0]=0,e[1]=0,e[2]=-1,this.transformVectorWorld(e),e}getUp(e){return e[0]=0,e[1]=1,e[2]=0,this.transformVectorWorld(e),e}getRight(e){return e[0]=1,e[1]=0,e[2]=0,this.transformVectorWorld(e),e}transformVectorWorld(e,t){t=t||e;let n=this._engine.wasm;return n._tempMemFloat[0]=t[0],n._tempMemFloat[1]=t[1],n._tempMemFloat[2]=t[2],_wl_object_transformVectorWorld(this.objectId,n._tempMem),e[0]=n._tempMemFloat[0],e[1]=n._tempMemFloat[1],e[2]=n._tempMemFloat[2],e}transformVectorLocal(e,t){t=t||e;let n=this._engine.wasm;return n._tempMemFloat[0]=t[0],n._tempMemFloat[1]=t[1],n._tempMemFloat[2]=t[2],_wl_object_transformVectorLocal(this.objectId,n._tempMem),e[0]=n._tempMemFloat[0],e[1]=n._tempMemFloat[1],e[2]=n._tempMemFloat[2],e}transformPointWorld(e,t){t=t||e;let n=this._engine.wasm;return n._tempMemFloat[0]=t[0],n._tempMemFloat[1]=t[1],n._tempMemFloat[2]=t[2],_wl_object_transformPointWorld(this.objectId,n._tempMem),e[0]=n._tempMemFloat[0],e[1]=n._tempMemFloat[1],e[2]=n._tempMemFloat[2],e}transformPointLocal(e,t){t=t||e;let n=this._engine.wasm;return n._tempMemFloat[0]=t[0],n._tempMemFloat[1]=t[1],n._tempMemFloat[2]=t[2],_wl_object_transformPointLocal(this.objectId,n._tempMem),e[0]=n._tempMemFloat[0],e[1]=n._tempMemFloat[1],e[2]=n._tempMemFloat[2],e}transformVectorInverseWorld(e,t){t=t||e;let n=this._engine.wasm;return n._tempMemFloat[0]=t[0],n._tempMemFloat[1]=t[1],n._tempMemFloat[2]=t[2],_wl_object_transformVectorInverseWorld(this.objectId,n._tempMem),e[0]=n._tempMemFloat[0],e[1]=n._tempMemFloat[1],e[2]=n._tempMemFloat[2],e}transformVectorInverseLocal(e,t){t=t||e;let n=this._engine.wasm;return n._tempMemFloat[0]=t[0],n._tempMemFloat[1]=t[1],n._tempMemFloat[2]=t[2],_wl_object_transformVectorInverseLocal(this.objectId,n._tempMem),e[0]=n._tempMemFloat[0],e[1]=n._tempMemFloat[1],e[2]=n._tempMemFloat[2],e}transformPointInverseWorld(e,t){t=t||e;let n=this._engine.wasm;return n._tempMemFloat[0]=t[0],n._tempMemFloat[1]=t[1],n._tempMemFloat[2]=t[2],_wl_object_transformPointInverseWorld(this.objectId,n._tempMem),e[0]=n._tempMemFloat[0],e[1]=n._tempMemFloat[1],e[2]=n._tempMemFloat[2],e}transformPointInverseLocal(e,t){t=t||e;let n=this._engine.wasm;return n._tempMemFloat.set(t),_wl_object_transformPointInverseLocal(this.objectId,n._tempMem),e[0]=n._tempMemFloat[0],e[1]=n._tempMemFloat[1],e[2]=n._tempMemFloat[2],e}toWorldSpaceTransform(e,t){t=t||e;let n=this._engine.wasm;return n._tempMemFloat.set(t),_wl_object_toWorldSpaceTransform(this.objectId,n._tempMem),e[0]=n._tempMemFloat[0],e[1]=n._tempMemFloat[1],e[2]=n._tempMemFloat[2],e[3]=n._tempMemFloat[3],e[4]=n._tempMemFloat[4],e[5]=n._tempMemFloat[5],e[6]=n._tempMemFloat[6],e[7]=n._tempMemFloat[7],e}toLocalSpaceTransform(e,t){let n=this.parent;return t=t||e,n?n.toObjectSpaceTransform(t):e!==t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7]),e}toObjectSpaceTransform(e,t){t=t||e;let n=this._engine.wasm;return n._tempMemFloat.set(t),_wl_object_toObjectSpaceTransform(this.objectId,n._tempMem),e[0]=n._tempMemFloat[0],e[1]=n._tempMemFloat[1],e[2]=n._tempMemFloat[2],e[3]=n._tempMemFloat[3],e[4]=n._tempMemFloat[4],e[5]=n._tempMemFloat[5],e[6]=n._tempMemFloat[6],e[7]=n._tempMemFloat[7],e}lookAt(e,t=xe){_wl_object_lookAt(this.objectId,e[0],e[1],e[2],t[0],t[1],t[2])}destroy(){_wl_scene_remove_object(this.objectId),this.objectId=null}setDirty(){_wl_object_set_dirty(this.objectId)}set active(e){let t=this.getComponents();for(let n of t)n.active=e}getComponent(e,t){let n=R(e)?e:e.TypeName,r=lengthBytesUTF8(n)+1,o=_malloc(r);stringToUTF8(n,o,r);let s=_wl_get_component_manager_index(o);if(_free(o),s<0){let a=this._engine.wasm._componentTypeIndices[n],l=_wl_get_js_component_index(this.objectId,a,t||0);return l<0?null:this._engine.wasm._components[l]}let i=_wl_get_component_id(this.objectId,s,t||0);return this._engine._wrapComponent(n,s,i)}getComponents(e){let t=null,n=null;e&&(n=R(e)?e:e.TypeName,t=h._typeIndexFor(n));let r=this._engine.wasm,o=[],s=Math.floor(r._tempMemSize/3*2),i=_wl_object_get_components(this.objectId,r._tempMem,s),a=2*i;_wl_object_get_component_types(this.objectId,r._tempMem+a,s);let l=h._typeIndexFor("js");for(let c=0;c<i;++c){let m=r._tempMemUint8[c+a],d=r._tempMemUint16[c];if(m==l){let V=_wl_get_js_component_index_for_id(d),z=r._components[V];(t===null||z.type==n)&&o.push(z);continue}if(t===null){let V=h._typeNameFor(m);o.push(this._engine._wrapComponent(V,m,d))}else m==t&&o.push(this._engine._wrapComponent(n,t,d))}return o}addComponent(e,t){let n=this._engine.wasm,r=R(e)?e:e.TypeName,o=h._typeIndexFor(r),s=null,i=null;if(o<0){if(!(r in n._componentTypeIndices))throw new TypeError("Unknown component type '"+r+"'");let a=_wl_object_add_js_component(this.objectId,n._componentTypeIndices[r]);i=_wl_get_js_component_index_for_id(a),s=n._components[i]}else{let a=_wl_object_add_component(this.objectId,o);s=this._engine._wrapComponent(r,o,a)}if(t!==void 0)for(let a in t)fe.includes(a)||(s[a]=t[a]);return o<0&&_wljs_component_init(i),(!t||!("active"in t&&!t.active))&&(s.active=!0),s}get changed(){return!!_wl_object_is_changed(this.objectId)}equals(e){return e?this.objectId==e.objectId:!1}static _typeIndexFor(e){let t=lengthBytesUTF8(e)+1,n=_malloc(t);stringToUTF8(e,n,t);let r=_wl_get_component_manager_index(n);return _free(n),r}static _typeNameFor(e){return UTF8ToString(_wl_component_manager_name(e))}},E=class{constructor(e){this._index=e}get jointCount(){return _wl_skin_get_joint_count(this._index)}get jointIds(){return new Uint16Array(HEAPU16.buffer,_wl_skin_joint_ids(this._index),this.jointCount)}get inverseBindTransforms(){return new Float32Array(HEAPF32.buffer,_wl_skin_inverse_bind_transforms(this._index),8*this.jointCount)}get inverseBindScalings(){return new Float32Array(HEAPF32.buffer,_wl_skin_inverse_bind_scalings(this._index),3*this.jointCount)}};var B=class{constructor(e,t){assert((t&3)==0,we),this._engine=e,this._ptr=t}get locations(){let e=this._ptr,t=[];for(let n=0;n<this.hitCount;++n)t.push(new Float32Array(HEAPF32.buffer,e+12*n,3));return t}get normals(){let e=this._ptr+48,t=[];for(let n=0;n<this.hitCount;++n)t.push(new Float32Array(HEAPF32.buffer,e+12*n,3));return t}get distances(){let e=this._ptr+48*2;return new Float32Array(HEAPF32.buffer,e,this.hitCount)}get objects(){let e=this._ptr+(48*2+16),t=new Uint16Array(HEAPU16.buffer,e,this.hitCount);return[t[0]<=0?null:this._engine.wrapObject(t[0]),t[1]<=0?null:this._engine.wrapObject(t[1]),t[2]<=0?null:this._engine.wrapObject(t[2]),t[3]<=0?null:this._engine.wrapObject(t[3])]}get hitCount(){return Math.min(HEAPU32[this._ptr/4+30],4)}},de=class{static cubicHermite(e,t,n,r,o,s,i=WL){let a=i.wasm;a._tempMemFloat.subarray(0).set(t),a._tempMemFloat.subarray(4).set(n),a._tempMemFloat.subarray(8).set(r),a._tempMemFloat.subarray(12).set(o);let l=t.length==4;return _wl_math_cubicHermite(a._tempMem+4*16,a._tempMem+4*0,a._tempMem+4*4,a._tempMem+4*8,a._tempMem+4*12,s,l),e[0]=a._tempMemFloat[16],e[1]=a._tempMemFloat[17],e[2]=a._tempMemFloat[18],l&&(e[3]=a._tempMemFloat[19]),e}};var y=new Array(11);y[u.Bool]=!1;y[u.Int]=0;y[u.Float]=0;y[u.String]="";y[u.Enum]=0;y[u.Object]=null;y[u.Mesh]=null;y[u.Texture]=null;y[u.Material]=null;y[u.Animation]=null;y[u.Skin]=null;function be(_){for(let e in _.Properties){let t=_.Properties[e];t.default=t.default||y[t.type],_.prototype[e]=t.default}}var re=null,oe=null,ie=[],se=[];function je(){if(typeof navigator=="undefined"||!navigator.xr){re=!1,oe=!1;return}navigator.xr.isSessionSupported("immersive-vr").then(function(_){re=_;for(let e of ie)e(_)}),navigator.xr.isSessionSupported("immersive-ar").then(function(_){oe=_;for(let e of se)e(_)})}var f,H,ae=class{constructor(e){this.onXRSessionStart=[];this.onXRSessionEnd=[];this.arSupported=void 0;this.vrSupported=void 0;this.onXRSupported=[];this.onSceneLoaded=[];this.scene=null;this.canvas=null;this._componentCache={};this._objectCache=[];me(this,f,void 0);me(this,H,null);Z(this,f,e),F(this,f)._setEngine(this),this.textures={load:(r,o)=>{let s=new Image;return o!==void 0&&(s.crossOrigin=o),s.src=r,new Promise((i,a)=>{s.onload=function(){let l=new M(s);l.valid||a("Failed to add image "+s.src+" to texture atlas. Probably incompatible format."),i(l)},s.onerror=function(){a("Failed to load image. Not found or no read access")}})}},this._componentCache={},this._objectCache.length=0;let t=r=>{let o=se.indexOf(t);o>=0&&se.splice(o,1),this.arSupported=r;for(let s of this.onXRSupported)s("ar",r)};se.push(t);let n=r=>{let o=ie.indexOf(n);o>=0&&ie.splice(o,1),this.vrSupported=r;for(let s of this.onXRSupported)s("vr",r)};ie.push(n),oe!==null&&t(oe),re!==null&&n(re)}start(){window._wl_application_start()}registerComponent(...e){if(R(e[0])){let t=this.wasm._registerComponentLegacy(e[0],e[1],e[2]),n=this.wasm._componentTypes[t];be(n);return}for(let t of e){let n=this.wasm._registerComponent(t),r=this.wasm._componentTypes[n];be(r)}}requestXRSession(e,t,n){return F(this,f).webxr_request_session_func(e,t,n!=null?n:[])}wrapObject(e){let t=this._objectCache,n=t[e]||(t[e]=new h(this,e));return n.objectId=e,n}get wasm(){return F(this,f)}get xrSession(){return F(this,f).webxr_session}get xrFrame(){return F(this,f).webxr_frame}get xrBaseLayer(){return F(this,f).webxr_baseLayer}get xrFramebuffer(){return Array.isArray(this.wasm.webxr_fbo)?GL.framebuffers[this.wasm.webxr_fbo[0]]:GL.framebuffers[this.wasm.webxr_fbo]}get physics(){return F(this,H)}_init(){if(this.scene=new X(this),this.canvas=typeof document=="undefined"?null:document.getElementById("canvas"),_wl_set_error_callback(addFunction(function(e){throw new Error(UTF8ToString(e))},"vi")),Z(this,H,null),F(this,f).withPhysX){let e=new $(this);_wl_physx_set_collision_callback(addFunction((t,n,r,o)=>{let s=e._callbacks[t][n],i=new S(this,h._typeIndexFor("physx"),o);s(r,i)},"viiii")),Z(this,H,e)}je()}_reset(){this._componentCache={},this._objectCache.length=0,this.scene.reset(),this.wasm.reset()}_wrapComponent(e,t,n){if(n<0)return null;let r=this._componentCache[t]||(this._componentCache[t]=[]);if(r[n])return r[n];let o;if(e=="collision")o=new P(this,t,n);else if(e=="text")o=new N(this,t,n);else if(e=="view")o=new v(this,t,n);else if(e=="mesh")o=new D(this,t,n);else if(e=="input")o=new W(this,t,n);else if(e=="light")o=new L(this,t,n);else if(e=="animation")o=new k(this,t,n);else if(e=="physx")o=new S(this,t,n);else{let s=this.wasm._componentTypeIndices[e],i=this.wasm._componentTypes[s];o=new i(this)}return o._engine=this,o._manager=t,o._id=n,r[n]=o,o}};f=new WeakMap,H=new WeakMap;var _e=class{constructor(e){this.worker="";this.wasm=null;this.webxr_session=null;this.webxr_request_session_func=null;this.webxr_frame=null;this.webxr_baseLayer=null;this.webxr_fbo=-1;this._deactivate_component_on_error=!1;this._tempMem=null;this._tempMemSize=0;this._tempMemFloat=null;this._tempMemInt=null;this._tempMemUint8=null;this._tempMemUint32=null;this._tempMemUint16=null;this._sceneLoadedCallback=[];this._materialDefinitions=[];this._images=[];this._components=[];this._componentTypes=[];this._componentTypeIndices={};this._engine=null;this._withPhysX=!1;this._utf8Decoder=new TextDecoder("utf8");if(e){this.UTF8ViewToString=(t,n)=>t?this._utf8Decoder.decode(HEAPU8.slice(t,n)):"";return}this.UTF8ViewToString=(t,n)=>t?this._utf8Decoder.decode(HEAPU8.subarray(t,n)):""}reset(){this._materialDefinitions=[],this._images=[],this._components=[],this._componentTypes=[],this._componentTypeIndices={}}_registerComponentLegacy(e,t,n){let r=class extends g{};return r.TypeName=e,r.Properties=t,Object.assign(r.prototype,n),this._registerComponent(r)}_registerComponent(e){if(!e.TypeName)throw new Error("no name provided for component.");let t=e.TypeName in this._componentTypeIndices?this._componentTypeIndices[e.TypeName]:this._componentTypes.length;return this._componentTypes[t]=e,this._componentTypeIndices[e.TypeName]=t,console.log("WL: registered component",e.TypeName,"with index",t),t}allocateTempMemory(e){console.log("Allocating temp mem:",e),this._tempMemSize=e,this._tempMem&&_free(this._tempMem),this._tempMem=_malloc(this._tempMemSize),this.updateTempMemory()}requireTempMem(e){this._tempMemSize>=e||this.allocateTempMemory(Math.ceil(e/1024)*1024)}updateTempMemory(){this._tempMemFloat=new Float32Array(HEAP8.buffer,this._tempMem,this._tempMemSize>>2),this._tempMemInt=new Int32Array(HEAP8.buffer,this._tempMem,this._tempMemSize>>2),this._tempMemUint32=new Uint32Array(HEAP8.buffer,this._tempMem,this._tempMemSize>>2),this._tempMemUint16=new Uint16Array(HEAP8.buffer,this._tempMem,this._tempMemSize>>1),this._tempMemUint8=new Uint8Array(HEAP8.buffer,this._tempMem,this._tempMemSize)}getTempBufferU8(e){return this.requireTempMem(e),this._tempMemUint8}getTempBufferU16(e){return this.requireTempMem(e*2),this._tempMemUint16}getTempBufferU32(e){return this.requireTempMem(e*4),this._tempMemUint32}getTempBufferI32(e){return this.requireTempMem(e*4),this._tempMemInt}getTempBufferF32(e){return this.requireTempMem(e*4),this._tempMemFloat}_notifySceneLoaded(){for(let e of this._engine.onSceneLoaded)try{e()}catch(t){console.error("Exception during onSceneLoaded callback"),console.error(t)}}get withPhysX(){return this._withPhysX}_setEngine(e){this._engine=e}_wljs_xr_session_start(e){for(let t of this._engine.onXRSessionStart)try{t(this.webxr_session,e)}catch(n){console.error("Exception during onXRSessionStart callback:"),console.error(n)}}_wljs_xr_session_end(){for(let e of this._engine.onXRSessionEnd)try{e()}catch(t){console.error("Exception during onXRSessionEnd callback:"),console.error(t)}}_wljs_xr_disable(){this._engine.arSupported=!1,this._engine.vrSupported=!1;for(let e of this._engine.onXRSupported)e("ar",!1),e("vr",!1)}_wljs_engine_pre_render(){let e=this._engine.scene;for(let t of e.onPreRender)t()}_wljs_engine_post_render(){let e=this._engine.scene;for(let t of e.onPostRender)t()}_wljs_allocate(e){this._components=new Array(e)}_wljs_init(e){var t;this._withPhysX=e,this.allocateTempMemory(1024),(t=this.onReady)==null||t.call(this)}_wljs_reallocate(e){e>this._components.length&&(this._components.length=e)}_wljs_scene_add_material_definition(e){let t=new Map,n=_wl_material_definition_get_count(e);for(let r=0;r<n;++r){let o=UTF8ToString(_wl_material_definition_get_param_name(e,r)),s=_wl_material_definition_get_param_type(e,r);t.set(o,{index:r,type:{type:s&255,componentCount:s>>8&255,metaType:s>>16&255}})}this._materialDefinitions[e]=t}_wljs_set_component_param_bool(e,t,n,r){let o=this.UTF8ViewToString(t,n);this._components[e][o]=r!==0}_wljs_set_component_param_int(e,t,n,r){let o=this.UTF8ViewToString(t,n);this._components[e][o]=r}_wljs_set_component_param_float(e,t,n,r){let o=this.UTF8ViewToString(t,n);this._components[e][o]=r}_wljs_set_component_param_string(e,t,n,r,o){let s=this.UTF8ViewToString(t,n),i=this.UTF8ViewToString(r,o);this._components[e][s]=i}_wljs_set_component_param_object(e,t,n,r){let o=this.UTF8ViewToString(t,n);this._components[e][o]=r>0?this._engine.wrapObject(r):null}_wljs_set_component_param_mesh(e,t,n,r){let o=this.UTF8ViewToString(t,n);this._components[e][o]=r>0?new A(r,this._engine):null}_wljs_set_component_param_texture(e,t,n,r){let o=this.UTF8ViewToString(t,n);this._components[e][o]=r>0?new M(r,this._engine):null}_wljs_set_component_param_material(e,t,n,r){let o=this.UTF8ViewToString(t,n);this._components[e][o]=r>0?new j(this._engine,r):null}_wljs_set_component_param_animation(e,t,n,r){let o=this.UTF8ViewToString(t,n);this._components[e][o]=r>0?new C(r):null}_wljs_set_component_param_skin(e,t,n,r){let o=this.UTF8ViewToString(t,n);this._components[e][o]=r>0?new E(r):null}_wljs_get_component_type_index(e){return this._componentTypeIndices[UTF8ToString(e)]}_wljs_component_create(e,t,n,r,o){let s=this._componentTypes[r],i=new s;return i._engine=this._engine,i._manager=e,i._id=n,i._object=this._engine.wrapObject(o),i._type=s.TypeName,this._components[t]=i,i}_wljs_component_init(e){let t=this._components[e];if(t.init)try{t.init()}catch(n){console.error(`Exception during ${t.type} init() on object ${t.object.name}`),console.error(n)}if(t.start){let n=t.onActivate;t.onActivate=function(){try{this.start&&this.start()}catch(r){console.error(`Exception during ${this.type} start() on object ${this.object.name}`),console.error(r)}if(this.onActivate=n,this.onActivate)try{this.onActivate()}catch(r){console.error(`Exception during ${this.type} onActivate() on object ${this.object.name}`),console.error(r)}}}}_wljs_component_update(e,t){let n=this._components[e];if(!n){console.warn("WL: component was undefined:",e),this._components[e]=new g(this._engine);return}if(!!n.update)try{n.update(t)}catch(r){console.error(`Exception during ${n.type} update() on object ${n.object.name}`),console.error(r),this._deactivate_component_on_error&&(n.active=!1)}}_wljs_component_onActivate(e){let t=this._components[e];if(!(!t||!t.onActivate))try{t.onActivate()}catch(n){console.error(`Exception during ${t.type} onActivate() on object ${t.object.name}`),console.error(n)}}_wljs_component_onDeactivate(e){let t=this._components[e];if(!!t.onDeactivate)try{t.onDeactivate()}catch(n){console.error(`Exception during ${t.type} onDeactivate() on object ${t.object.name}`),console.error(n)}}_wljs_component_onDestroy(e){let t=this._components[e];if(!!t.onDestroy)try{t.onDestroy()}catch(n){console.error(`Exception during ${t.type} onDestroy() on object ${t.object.name}`),console.error(n)}}_wljs_swap(e,t){let n=this._components[e];this._components[e]=this._components[t],this._components[t]=n}};function Fe(){return I(this,null,function*(){let[_,e]=yield Promise.all([he(),ge()]);return _?console.log("WASM SIMD is supported"):console.warn("WASM SIMD is not supported"),e?self.crossOriginIsolated?console.log("WASM Threads is supported"):console.warn("WASM Threads is supported, but the page is not crossOriginIsolated, therefore thread support is disabled."):console.warn("WASM Threads is not supported"),e=e&&self.crossOriginIsolated,{simdSupported:_,threadsSupported:e}})}function Ce(t){return I(this,arguments,function*(_,e={}){let{simdSupported:n,threadsSupported:r}=yield Fe(),{simd:o=n,threads:s=r,physx:i=!1,loader:a=!1}=e,l=`${_}${a?"-loader":""}${i?"-physx":""}${o?"-simd":""}${s?"-threads":""}`,c=yield fetch(l+".wasm");if(!c.ok)return Promise.reject("Failed to fetch runtime .wasm file");let m=new _e(s);m.worker=`${l}.worker.js`,m.wasm=yield c.arrayBuffer();let d=new ae(m);return yield new Promise((V,z)=>{m.onReady=V,window.Module=m;let G=document.createElement("script");G.type="text/javascript",G.src=`${l}.js`,G.onerror=function(){z("Failed to fetch runtime .js file")},document.body.append(G)}),d._init(),d.start(),Object.assign(d,le),window.WL=d,d})}return Ae;})();
//# sourceMappingURL=wonderland.min.js.map
