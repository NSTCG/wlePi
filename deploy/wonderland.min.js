var WL=(()=>{var Ie=Object.defineProperty;var ve=(i,e)=>{for(var t in e)Ie(i,t,{get:e[t],enumerable:!0})};var R=(i,e,t)=>new Promise((n,r)=>{var s=m=>{try{a(t.next(m))}catch(c){r(c)}},_=m=>{try{a(t.throw(m))}catch(c){r(c)}},a=m=>m.done?n(m.value):Promise.resolve(m.value).then(s,_);a((t=t.apply(i,e)).next())});var Be={};ve(Be,{Alignment:()=>re,Animation:()=>U,AnimationComponent:()=>K,AnimationState:()=>ae,Collider:()=>ne,CollisionComponent:()=>Z,CollisionEventType:()=>_e,Component:()=>x,ForceMode:()=>k,InputComponent:()=>Q,InputType:()=>C,Justification:()=>oe,LightComponent:()=>J,LightType:()=>se,Material:()=>S,MaterialParamType:()=>y,Mesh:()=>E,MeshAttribute:()=>p,MeshAttributeAccessor:()=>ue,MeshComponent:()=>q,MeshIndexType:()=>A,Object:()=>h,PhysXComponent:()=>P,Physics:()=>ce,RayHit:()=>G,Scene:()=>le,Shape:()=>v,Skin:()=>ee,TextComponent:()=>Y,TextEffect:()=>ie,Texture:()=>O,Type:()=>b,ViewComponent:()=>D,_images:()=>I,_initPhysics:()=>We,_sceneLoadedCallback:()=>z,_wrapComponent:()=>B,_wrapObject:()=>w,arSupported:()=>ge,canvas:()=>he,init:()=>Le,isString:()=>te,loadRuntime:()=>Me,math:()=>Ce,onSceneLoaded:()=>Pe,onXRSessionEnd:()=>Ne,onXRSessionStart:()=>Re,onXRSupported:()=>Ue,physics:()=>F,registerComponent:()=>Ee,reset:()=>ke,scene:()=>fe,textures:()=>je,updateTempMemory:()=>Ae,vrSupported:()=>ye,xrSession:()=>W});var me=()=>R(void 0,null,function*(){return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]))});var pe=()=>(i=>R(void 0,null,function*(){try{return typeof MessageChannel!="undefined"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(i)}catch(e){return!1}}))(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]));var Fe="Misaligned pointer: please report a bug",M={},$=[],Se=["_id","_manager","type","_type","active"],b;(function(d){d[d.Bool=2]="Bool",d[d.Int=4]="Int",d[d.Float=8]="Float",d[d.String=16]="String",d[d.Enum=32]="Enum",d[d.Object=64]="Object",d[d.Mesh=128]="Mesh",d[d.Texture=256]="Texture",d[d.Material=512]="Material",d[d.Animation=1024]="Animation",d[d.Skin=2048]="Skin"})(b||(b={}));var g=new Array(6);g[2]=!1;g[4]=0;g[8]=0;g[16]="";g[32]=0;g[64]=null;g[128]=null;g[256]=null;g[512]=null;g[1024]=null;g[2048]=null;function be(i){for(let e in i.Properties){let t=i.Properties[e];t.default=t.default||g[t.type],i.prototype[e]=t.default}}function Ee(...i){if(_WL.isString(i[0])){let e=_WL.registerComponent(i[0],i[1],i[2]),t=_WL._componentTypes[e];be(t);return}for(let e of i){let t=_WL.registerComponent(e),n=_WL._componentTypes[t];be(n)}}var ne;(function(n){n[n.Sphere=0]="Sphere",n[n.AxisAlignedBox=1]="AxisAlignedBox",n[n.Box=2]="Box"})(ne||(ne={}));var re;(function(n){n[n.Left=1]="Left",n[n.Center=2]="Center",n[n.Right=3]="Right"})(re||(re={}));var oe;(function(r){r[r.Line=1]="Line",r[r.Middle=2]="Middle",r[r.Top=3]="Top",r[r.Bottom=4]="Bottom"})(oe||(oe={}));var ie;(function(t){t[t.None=0]="None",t[t.Outline=1]="Outline"})(ie||(ie={}));var C;(function(a){a[a.Head=0]="Head",a[a.EyeLeft=1]="EyeLeft",a[a.EyeRight=2]="EyeRight",a[a.ControllerLeft=3]="ControllerLeft",a[a.ControllerRight=4]="ControllerRight",a[a.RayLeft=5]="RayLeft",a[a.RayRight=6]="RayRight"})(C||(C={}));var se;(function(n){n[n.Point=1]="Point",n[n.Spot=2]="Spot",n[n.Sun=3]="Sun"})(se||(se={}));var ae;(function(n){n[n.Playing=1]="Playing",n[n.Paused=2]="Paused",n[n.Stopped=3]="Stopped"})(ae||(ae={}));var k;(function(r){r[r.Force=0]="Force",r[r.Impulse=1]="Impulse",r[r.VelocityChange=2]="VelocityChange",r[r.Acceleration=3]="Acceleration"})(k||(k={}));var _e;(function(r){r[r.Touch=0]="Touch",r[r.TouchLost=1]="TouchLost",r[r.TriggerTouch=2]="TriggerTouch",r[r.TriggerTouchLost=3]="TriggerTouchLost"})(_e||(_e={}));var v;(function(a){a[a.None=0]="None",a[a.Sphere=1]="Sphere",a[a.Capsule=2]="Capsule",a[a.Box=3]="Box",a[a.Plane=4]="Plane",a[a.ConvexMesh=5]="ConvexMesh",a[a.TriangleMesh=6]="TriangleMesh"})(v||(v={}));var p;(function(c){c[c.Position=0]="Position",c[c.Tangent=1]="Tangent",c[c.Normal=2]="Normal",c[c.TextureCoordinate=3]="TextureCoordinate",c[c.Color=4]="Color",c[c.JointId=5]="JointId",c[c.JointWeight=6]="JointWeight",c[c.SecondaryJointId=7]="SecondaryJointId",c[c.SecondaryJointWeight=8]="SecondaryJointWeight"})(p||(p={}));var y;(function(s){s[s.UnsignedInt=0]="UnsignedInt",s[s.Int=1]="Int",s[s.Float=2]="Float",s[s.Sampler=3]="Sampler",s[s.Font=4]="Font"})(y||(y={}));var he=null,W=null,Re=[i=>{W=i}],Ne=[()=>{W=null}],ge,ye,Ue=[(i,e)=>{i=="ar"&&(ge=e),i=="vr"&&(ye=e)}],Pe=[],fe,F,I=[],z=[],l=null,f=0,o=null,H=null,T=null,N=null,we=null;function Le(){fe=new le,he=typeof document=="undefined"?null:document.getElementById("canvas"),M={},$=[],xe(1024)}function ke(){M={},$.length=0,I.length=0,z.length=0,_WL.reset()}function We(){F=new ce}function xe(i){console.log("Allocating temp mem:",i),f=i,l&&_free(l),l=_malloc(f),Ae()}function X(i){f>=i||xe(Math.ceil(i/1024)*1024)}function Ae(){o=new Float32Array(HEAP8.buffer,l,f>>2),H=new Int32Array(HEAP8.buffer,l,f>>2),T=new Uint32Array(HEAP8.buffer,l,f>>2),N=new Uint16Array(HEAP8.buffer,l,f>>1),we=new Uint8Array(HEAP8.buffer,l,f)}function He(i){return X(i*2),N}function De(i){return X(i*4),o}var Oe=[0,1,0],le=class{constructor(){this._rayHit=_malloc(4*(3*4+3*4+4+2)+4),this._hit=new G(this._rayHit),this.onPreRender=[],this.onPostRender=[]}get activeViews(){let e=_wl_scene_get_active_views(l,16),t=[],n=h._typeIndexFor("view");for(let r=0;r<e;++r)t.push(new D(n,H[r]));return t}rayCast(e,t,n){return _wl_scene_ray_cast(e[0],e[1],e[2],t[0],t[1],t[2],n,this._rayHit),this._hit}addObject(e){let t=e?e.objectId:0,n=_wl_scene_add_object(t);return w(n)}addObjects(e,t,n){let r=t?t.objectId:0;X(e*2);let s=_wl_scene_add_objects(r,e,n||0,l,f>>1),_=N.subarray(0,s);return Array.from(_,w)}reserveObjects(e,t){t=t||{};let n=h._typeIndexFor("js"),r=H.subarray();r.fill(0);for(let s of Object.entries(t)){let _=h._typeIndexFor(s[0]);r[_<0?n:_]+=s[1]}_wl_scene_reserve_objects(e,l)}set clearColor(e){_wl_scene_set_clearColor(e[0],e[1],e[2],e[3])}set colorClearEnabled(e){_wl_scene_enableColorClear(e)}load(e){let t=lengthBytesUTF8(e)+1,n=_malloc(t);stringToUTF8(e,n,t),_wl_load_scene(n),_free(n)}append(e,t){t=t||{};let n=!!t.loadGltfExtensions,r=lengthBytesUTF8(e)+1,s=_malloc(r);stringToUTF8(e,s,r);let _=z.length,a=new Promise((m,c)=>{z[_]={success:(u,d)=>{let j=w(u);m(d?{root:j,extensions:d}:j)},error:()=>c()}});return _wl_append_scene(s,n,_),_free(s),a}_unmarshallGltfExtensions(e){let t={root:{},mesh:{},node:{},idMapping:{}},n=0,r=()=>{let u=e[n++],d=e[n++];return _WL.UTF8ViewToString(u,u+d)},s=e[n++],_=new Array(s);for(let u=0;u<s;++u)_[u]=e[n++];t.idMapping=_;let a=e[n++];for(let u=0;u<a;++u){let d=e[n++];t.mesh[_[d]]=JSON.parse(r())}let m=e[n++];for(let u=0;u<m;++u){let d=e[n++];t.node[_[d]]=JSON.parse(r())}let c=r();return c&&(t.root=JSON.parse(c)),t}reset(){_wl_scene_reset()}},x=class{constructor(e=-1,t=-1){this._manager=e,this._id=t,this._object=null,this._type=null}get type(){return this._type||h._typeNameFor(this._manager)}get object(){if(!this._object){let e=_wl_component_get_object(this._manager,this._id);this._object=w(e)}return this._object}set active(e){_wl_component_setActive(this._manager,this._id,e)}get active(){return _wl_component_isActive(this._manager,this._id)!=0}destroy(){_wl_component_remove(this._manager,this._id),this._manager=void 0,this._id=void 0}equals(e){return e?this._manager==e._manager&&this._id==e._id:!1}},de=class extends x{get collider(){return _wl_collision_component_get_collider(this._id)}set collider(e){_wl_collision_component_set_collider(this._id,e)}get extents(){return new Float32Array(HEAPF32.buffer,_wl_collision_component_get_extents(this._id),3)}set extents(e){this.extents.set(e)}get group(){return _wl_collision_component_get_group(this._id)}set group(e){_wl_collision_component_set_group(this._id,e)}queryOverlaps(){let e=_wl_collision_component_query_overlaps(this._id,l,f>>1),t=new Array(e);for(let n=0;n<e;++n)t[n]=new de(this._manager,N[n]);return t}},Z=de;Z.TypeName="collision";var Y=class extends x{get alignment(){return _wl_text_component_get_horizontal_alignment(this._id)}set alignment(e){_wl_text_component_set_horizontal_alignment(this._id,e)}get justification(){return _wl_text_component_get_vertical_alignment(this._id)}set justification(e){_wl_text_component_set_vertical_alignment(this._id,e)}get characterSpacing(){return _wl_text_component_get_character_spacing(this._id)}set characterSpacing(e){_wl_text_component_set_character_spacing(this._id,e)}get lineSpacing(){return _wl_text_component_get_line_spacing(this._id)}set lineSpacing(e){_wl_text_component_set_line_spacing(this._id,e)}get effect(){return _wl_text_component_get_effect(this._id)}set effect(e){_wl_text_component_set_effect(this._id,e)}get text(){return UTF8ToString(_wl_text_component_get_text(this._id))}set text(e){let t=lengthBytesUTF8(e)+1,n=_malloc(t);stringToUTF8(e,n,t),_wl_text_component_set_text(this._id,n),_free(n)}set material(e){let t=e?e._index:0;_wl_text_component_set_material(this._id,t)}get material(){let e=_wl_text_component_get_material(this._id);return e>0?new S(e):null}};Y.TypeName="text";var D=class extends x{get projectionMatrix(){return new Float32Array(HEAPF32.buffer,_wl_view_component_get_projection_matrix(this._id),16)}get near(){return _wl_view_component_get_near(this._id)}set near(e){_wl_view_component_set_near(this._id,e)}get far(){return _wl_view_component_get_far(this._id)}set far(e){_wl_view_component_set_far(this._id,e)}get fov(){return _wl_view_component_get_fov(this._id)}set fov(e){_wl_view_component_set_fov(this._id,e)}};D.TypeName="view";var Q=class extends x{get inputType(){return _wl_input_component_get_type(this._id)}set inputType(e){_wl_input_component_set_type(this._id,e)}get xrInputSource(){if(W){for(let e of W.inputSources)if(e.handedness==this.handedness)return e}return null}get handedness(){let e=this.inputType;return e==4||e==6||e==2?"right":e==3||e==5||e==1?"left":null}};Q.TypeName="input";var J=class extends x{get color(){return new Float32Array(HEAPF32.buffer,_wl_light_component_get_color(this._id),4)}get lightType(){return _wl_light_component_get_type(this._id)}set lightType(e){_wl_light_component_set_type(this._id,e)}};J.TypeName="light";var K=class extends x{set animation(e){_wl_animation_component_set_animation(this._id,e._index)}get animation(){return new U(_wl_animation_component_get_animation(this._id))}set playCount(e){_wl_animation_component_set_playCount(this._id,e)}get playCount(){return _wl_animation_component_get_playCount(this._id)}set speed(e){_wl_animation_component_set_speed(this._id,e)}get speed(){return _wl_animation_component_get_speed(this._id)}get state(){return _wl_animation_component_state(this._id)}play(){_wl_animation_component_play(this._id)}stop(){_wl_animation_component_stop(this._id)}pause(){_wl_animation_component_pause(this._id)}};K.TypeName="animation";var q=class extends x{set material(e){_wl_mesh_component_set_material(this._id,e?e._index:0)}get material(){let e=_wl_mesh_component_get_material(this._id);return e>0?new S(e):null}get mesh(){let e=_wl_mesh_component_get_mesh(this._id);return e>0?new E(e):null}set mesh(e){_wl_mesh_component_set_mesh(this._id,e?e._index:0)}get skin(){let e=_wl_mesh_component_get_skin(this._id);return e>0?new ee(e):null}set skin(e){_wl_mesh_component_set_skin(this._id,e?e._index:0)}};q.TypeName="mesh";var P=class extends x{set static(e){_wl_physx_component_set_static(this._id,e)}get static(){return!!_wl_physx_component_get_static(this._id)}set kinematic(e){_wl_physx_component_set_kinematic(this._id,e)}get kinematic(){return!!_wl_physx_component_get_kinematic(this._id)}set gravity(e){_wl_physx_component_set_gravity(this._id,e)}get gravity(){return!!_wl_physx_component_get_gravity(this._id)}set simulate(e){_wl_physx_component_set_simulate(this._id,e)}get simulate(){return!!_wl_physx_component_get_simulate(this._id)}set allowSimulation(e){_wl_physx_component_set_allowSimulation(this._id,e)}get allowSimulation(){return!!_wl_physx_component_get_allowSimulation(this._id)}set allowQuery(e){_wl_physx_component_set_allowQuery(this._id,e)}get allowQuery(){return!!_wl_physx_component_get_allowQuery(this._id)}set trigger(e){_wl_physx_component_set_trigger(this._id,e)}get trigger(){return!!_wl_physx_component_get_trigger(this._id)}set shape(e){_wl_physx_component_set_shape(this._id,e)}get shape(){return _wl_physx_component_get_shape(this._id)}set shapeData(e){e==null||![6,5].includes(this.shape)||_wl_physx_component_set_shape_data(this._id,e.index)}get shapeData(){return[6,5].includes(this.shape)?{index:_wl_physx_component_get_shape_data(this._id)}:null}set extents(e){this.extents.set(e)}get extents(){let e=_wl_physx_component_get_extents(this._id);return new Float32Array(HEAPF32.buffer,e,3)}get staticFriction(){return _wl_physx_component_get_staticFriction(this._id)}set staticFriction(e){_wl_physx_component_set_staticFriction(this._id,e)}get dynamicFriction(){return _wl_physx_component_get_dynamicFriction(this._id)}set dynamicFriction(e){_wl_physx_component_set_dynamicFriction(this._id,e)}get bounciness(){return _wl_physx_component_get_bounciness(this._id)}set bounciness(e){_wl_physx_component_set_bounciness(this._id,e)}get linearDamping(){return _wl_physx_component_get_linearDamping(this._id)}set linearDamping(e){_wl_physx_component_set_linearDamping(this._id,e)}get angularDamping(){return _wl_physx_component_get_angularDamping(this._id)}set angularDamping(e){_wl_physx_component_set_angularDamping(this._id,e)}set linearVelocity(e){_wl_physx_component_set_linearVelocity(this._id,e[0],e[1],e[2])}get linearVelocity(){return _wl_physx_component_get_linearVelocity(this._id,l),new Float32Array(HEAPF32.buffer,l,3)}set angularVelocity(e){_wl_physx_component_set_angularVelocity(this._id,e[0],e[1],e[2])}get angularVelocity(){return _wl_physx_component_get_angularVelocity(this._id,l),new Float32Array(HEAPF32.buffer,l,3)}set mass(e){_wl_physx_component_set_mass(this._id,e)}get mass(){return _wl_physx_component_get_mass(this._id)}set massSpaceInteriaTensor(e){_wl_physx_component_set_massSpaceInertiaTensor(this._id,e[0],e[1],e[2])}addForce(e,t,n,r,s){t=t||0,r?_wl_physx_component_addForceAt(this._id,e[0],e[1],e[2],t,!!n,r[0],r[1],r[2],!!s):_wl_physx_component_addForce(this._id,e[0],e[1],e[2],t,!!n)}addTorque(e,t=0){_wl_physx_component_addTorque(this._id,e[0],e[1],e[2],t)}onCollision(e){return this.onCollisionWith(this,e)}onCollisionWith(e,t){return F._callbacks[this._id]=F._callbacks[this._id]||[],F._callbacks[this._id].push(t),_wl_physx_component_addCallback(this._id,e._id||this._id)}removeCollisionCallback(e){let t=_wl_physx_component_removeCallback(this._id,e);t&&F._callbacks[this._id].splice(-t)}};P.TypeName="physx";for(let i of["static","extents","staticFriction","dynamicFriction","bounciness","linearDamping","angularDamping","shape","shapeData","kinematic","linearVelocity","angularVelocity","mass"])Object.defineProperty(P.prototype,i,{enumerable:!0});var ce=class{constructor(){this._rayHit=_malloc(4*(3*4+3*4+4+2)+4),this._hit=new G(this._rayHit),this._callbacks={}}rayCast(e,t,n,r){return typeof r=="undefined"&&(r=100),_wl_physx_ray_cast(e[0],e[1],e[2],t[0],t[1],t[2],n,r||100,this._rayHit),this._hit}_callCollisionCallback(e,t,n,r){F._callbacks[e][t](n,new P(h._typeIndexFor("physx"),r))}},A;(function(n){n[n.UnsignedByte=1]="UnsignedByte",n[n.UnsignedShort=2]="UnsignedShort",n[n.UnsignedInt=4]="UnsignedInt"})(A||(A={}));var E=class{static get VERTEX_FLOAT_SIZE(){return 3+3+2}static get VERTEX_SIZE(){return this.VERTEX_FLOAT_SIZE*4}static get POS(){return{X:0,Y:1,Z:2}}static get TEXCOORD(){return{U:3,V:4}}static get NORMAL(){return{X:5,Y:6,Z:7}}constructor(e){if(typeof e=="object"){if(!e.vertexCount&&e.vertexData&&(e.vertexCount=e.vertexData.length/E.VERTEX_FLOAT_SIZE),!e.vertexCount)throw new Error("Missing parameter 'vertexCount'");let t=0,n=0,r=0;if(e.indexData)switch(n=e.indexType||2,r=e.indexData.length*n,t=_malloc(r),n){case 1:HEAPU8.set(e.indexData,t);break;case 2:HEAPU16.set(e.indexData,t>>1);break;case 4:HEAPU32.set(e.indexData,t>>2);break}let{skinned:s=!1}=e;if(this._index=_wl_mesh_create(t,r,n,e.vertexCount,s),e.vertexData){let _=this.attribute(0),a=this.attribute(2),m=this.attribute(3);for(let c=0;c<e.vertexCount;++c){let u=c*E.VERTEX_FLOAT_SIZE;_.set(c,e.vertexData.subarray(u,u+3)),m==null||m.set(c,e.vertexData.subarray(u+3,u+5)),a==null||a.set(c,e.vertexData.subarray(u+5,u+8))}}}else this._index=e}get vertexData(){let e=_wl_mesh_get_vertexData(this._index,l);return new Float32Array(HEAPF32.buffer,e,E.VERTEX_FLOAT_SIZE*HEAPU32[l/4])}get vertexCount(){return _wl_mesh_get_vertexCount(this._index)}get indexData(){let e=_wl_mesh_get_indexData(this._index,l,l+4);if(e===null)return null;let t=HEAPU32[l/4];switch(HEAPU32[l/4+1]){case 1:return new Uint8Array(HEAPU8.buffer,e,t);case 2:return new Uint16Array(HEAPU16.buffer,e,t);case 4:return new Uint32Array(HEAPU32.buffer,e,t)}return null}update(){_wl_mesh_update(this._index)}getBoundingSphere(e=new Float32Array(4)){return _wl_mesh_get_boundingSphere(this._index,l),e[0]=o[0],e[1]=o[1],e[2]=o[2],e[3]=o[3],e}attribute(e){if(typeof e!="number")throw new TypeError("Expected number, but got "+typeof e);if(_wl_mesh_get_attribute(this._index,e,l),T[0]==255)return null;let t=new ue(e);t._attribute=T[0],t._offset=T[1],t._stride=T[2],t._formatSize=T[3],t._componentCount=T[4];let n=T[5];return t._arraySize=n||1,t.length=this.vertexCount,t}destroy(){_wl_mesh_destroy(this._index)}},ue=class{constructor(e=0){this._attribute=-1;this._offset=0;this._stride=0;this._formatSize=0;this._componentCount=0;this._arraySize=1;this.length=0;switch(e){case 0:case 2:case 3:case 1:case 4:case 6:this._bufferType=Float32Array,this._tempBufferGetter=De;break;case 5:this._bufferType=Uint16Array,this._tempBufferGetter=He;break;case 8:case 7:console.error(`Deprecated attribute accessor type: ${e}`);default:throw new Error(`Invalid attribute accessor type: ${e}`)}}createArray(e=1){return e=e>this.length?this.length:e,new this._bufferType(e*this._componentCount*this._arraySize)}get(e,t=this.createArray()){if(t.length%this._componentCount!=0)throw new Error(`out.length, ${t.length} is not a multiple of the attribute vector components, ${this._componentCount}`);let n=this._tempBufferGetter(t.length),r=this._bufferType.BYTES_PER_ELEMENT,s=r*t.length,_=this._formatSize*this._arraySize,a=this._componentCount*r*this._arraySize;_wl_mesh_get_attribute_values(this._attribute,_,this._offset+e*this._stride,this._stride,a,n.byteOffset,s);for(let m=0;m<t.length;++m)t[m]=n[m];return t}set(e,t){if(t.length%this._componentCount!=0)throw new Error(`out.length, ${t.length} is not a multiple of the attribute vector components, ${this._componentCount}`);let n=this._bufferType.BYTES_PER_ELEMENT,r=n*t.length,s=this._componentCount*n*this._arraySize,_=this._formatSize*this._arraySize;if(t.buffer!=HEAPU8.buffer){let a=this._tempBufferGetter(t.length);a.set(t),t=a}return _wl_mesh_set_attribute_values(this._attribute,s,t.byteOffset,r,_,this._offset+e*this._stride,this._stride),this}},S=class{constructor(e){if(typeof e!="number"){if(!(e==null?void 0:e.pipeline))throw new Error("Missing parameter 'pipeline'");let t=e.pipeline,n=lengthBytesUTF8(t)+1;if(stringToUTF8(t,l,n),this._index=_wl_material_create(l),this._index<0)throw new Error(`No such pipeline '${t}'`)}else this._index=e;if(this._definition=_wl_material_get_definition(this._index),!_WL._materialDefinitions[this._definition])throw new Error(`Material Definition ${this._definition} not found for material with index ${this._index}`);return new Proxy(this,{get(t,n){let s=_WL._materialDefinitions[t._definition].get(n);if(!s)return t[n];if(_wl_material_get_param_value(t._index,s.index,l)){let _=s.type;switch(_.type){case 0:return _.componentCount==1?T[0]:new Uint32Array(HEAPU32.buffer,l,_.componentCount);case 1:return _.componentCount==1?H[0]:new Int32Array(HEAP32.buffer,l,_.componentCount);case 2:return _.componentCount==1?o[0]:new Float32Array(HEAPF32.buffer,l,_.componentCount);case 3:return new O(H[0]);default:throw new Error(`Invalid type ${_} on parameter ${s.index} for material ${t._index}`)}}},set(t,n,r){let _=_WL._materialDefinitions[t._definition].get(n);if(!_)return t[n]=r,!0;switch(_.type.type){case 0:case 1:case 3:let m=r instanceof O?r.id:r;_wl_material_set_param_value_uint(t._index,_.index,m);break;case 2:let c=1;if(typeof r=="number")o[0]=r;else{c=r.length;for(let u=0;u<c;++u)o[u]=r[u]}_wl_material_set_param_value_float(t._index,_.index,l,c);break;case 4:throw new Error("Setting font properties is currently unsupported.")}return!0}})}get shader(){return UTF8ToString(_wl_material_get_shader(this._index))}clone(){let e=_wl_material_clone(this._index);return e>0?new S(e):null}static wrap(e){return e>0?new S(e):null}},L=null,O=class{constructor(e){this._id=0;this._imageIndex=void 0;if(e instanceof HTMLImageElement||e instanceof HTMLVideoElement||e instanceof HTMLCanvasElement){let t=I.length;I.push(e),this._imageIndex=t,this._id=_wl_renderer_addImage(t)}else this._id=e;je[this._id]=this}get valid(){return this._id>=0}get id(){return this._id}update(){!this.valid||_wl_renderer_updateImage(this._id,this._imageIndex)}get width(){return _wl_texture_width(this._id)}get height(){return _wl_texture_height(this._id)}updateSubImage(e,t,n,r){var _;if(!this.valid)return;L||(L=document.createElement("canvas"));let s=I[this._imageIndex];if(!!s){L.width=n,L.height=r,(_=L.getContext("2d"))==null||_.drawImage(s,e,t,n,r,0,0,n,r),I[this._imageIndex]=L;try{_wl_renderer_updateImage(this._id,this._imageIndex,e,(s.videoHeight||s.height)-t-r)}finally{I[this._imageIndex]=s}}}destroy(){_wl_texture_destroy(this._id),this._imageIndex&&(I[this._imageIndex]=null,this._imageIndex=void 0)}},je={load:function(i,e){let t=new Image;return e!==void 0&&(t.crossOrigin=e),t.src=i,new Promise((n,r)=>{t.onload=function(){let s=new O(t);s.valid||r("Failed to add image "+t.src+" to texture atlas. Probably incompatible format."),n(s)}})}},U=class{constructor(e){this._index=e}get duration(){return _wl_animation_get_duration(this._index)}get trackCount(){return _wl_animation_get_trackCount(this._index)}retarget(e){if(e instanceof ee){let r=_wl_animation_retargetToSkin(this._index,e._index);return new U(r)}if(e.length!=this.trackCount)throw Error("Expected "+this.trackCount.toString()+" targets, but got "+e.length.toString());let t=_malloc(2*e.length);for(let r=0;r<e.length;++r)HEAPU16[t>>1+r]=e[r].objectId;let n=_wl_animation_retarget(this._index,t);return _free(t),new U(n)}},h=class{constructor(e){this.objectId=e}get name(){return UTF8ToString(_wl_object_name(this.objectId))}set name(e){let t=lengthBytesUTF8(e)+1,n=_malloc(t);stringToUTF8(e,n,t),_wl_object_set_name(this.objectId,n),_free(n)}get parent(){let e=_wl_object_parent(this.objectId);return e==0?null:w(e)}get children(){let e=_wl_object_get_children_count(this.objectId);if(e===0)return[];X(e*2),_wl_object_get_children(this.objectId,l,f>>1);let t=new Array(e);for(let n=0;n<e;++n)t[n]=w(N[n]);return t}set parent(e){_wl_object_set_parent(this.objectId,e==null?0:e.objectId)}resetTransform(){_wl_object_reset_translation_rotation(this.objectId),_wl_object_reset_scaling(this.objectId)}resetTranslationRotation(){_wl_object_reset_translation_rotation(this.objectId)}resetRotation(){_wl_object_reset_rotation(this.objectId)}resetTranslation(){_wl_object_reset_translation(this.objectId)}resetScaling(){_wl_object_reset_scaling(this.objectId)}translate(e){_wl_object_translate(this.objectId,e[0],e[1],e[2])}translateObject(e){_wl_object_translate_obj(this.objectId,e[0],e[1],e[2])}translateWorld(e){_wl_object_translate_world(this.objectId,e[0],e[1],e[2])}rotateAxisAngleDeg(e,t){_wl_object_rotate_axis_angle(this.objectId,e[0],e[1],e[2],t)}rotateAxisAngleRad(e,t){_wl_object_rotate_axis_angle_rad(this.objectId,e[0],e[1],e[2],t)}rotateAxisAngleDegObject(e,t){_wl_object_rotate_axis_angle_obj(this.objectId,e[0],e[1],e[2],t)}rotateAxisAngleRadObject(e,t){_wl_object_rotate_axis_angle_rad_obj(this.objectId,e[0],e[1],e[2],t)}rotate(e){_wl_object_rotate_quat(this.objectId,e[0],e[1],e[2],e[3])}rotateObject(e){_wl_object_rotate_quat_obj(this.objectId,e[0],e[1],e[2],e[3])}scale(e){_wl_object_scale(this.objectId,e[0],e[1],e[2])}get transformLocal(){return new Float32Array(HEAPF32.buffer,_wl_object_trans_local(this.objectId),8)}set transformLocal(e){this.transformLocal.set(e),this.setDirty()}getTranslationLocal(e){return _wl_object_get_translation_local(this.objectId,l),e[0]=o[0],e[1]=o[1],e[2]=o[2],e}getTranslationWorld(e){return _wl_object_get_translation_world(this.objectId,l),e[0]=o[0],e[1]=o[1],e[2]=o[2],e}setTranslationLocal(e){_wl_object_set_translation_local(this.objectId,e[0],e[1],e[2])}setTranslationWorld(e){_wl_object_set_translation_world(this.objectId,e[0],e[1],e[2])}get transformWorld(){return new Float32Array(HEAPF32.buffer,_wl_object_trans_world(this.objectId),8)}set transformWorld(e){this.transformWorld.set(e),_wl_object_trans_world_to_local(this.objectId)}get scalingLocal(){return new Float32Array(HEAPF32.buffer,_wl_object_scaling_local(this.objectId),3)}set scalingLocal(e){this.scalingLocal.set(e),this.setDirty()}get scalingWorld(){return new Float32Array(HEAPF32.buffer,_wl_object_scaling_world(this.objectId),3)}set scalingWorld(e){this.scalingWorld.set(e),_wl_object_scaling_world_to_local(this.objectId)}get rotationLocal(){return this.transformLocal.subarray(0,4)}get rotationWorld(){return this.transformWorld.subarray(0,4)}set rotationLocal(e){_wl_object_set_rotation_local(this.objectId,e[0],e[1],e[2],e[3])}set rotationWorld(e){_wl_object_set_rotation_world(this.objectId,e[0],e[1],e[2],e[3])}getForward(e){return e[0]=0,e[1]=0,e[2]=-1,this.transformVectorWorld(e),e}getUp(e){return e[0]=0,e[1]=1,e[2]=0,this.transformVectorWorld(e),e}getRight(e){return e[0]=1,e[1]=0,e[2]=0,this.transformVectorWorld(e),e}transformVectorWorld(e,t){return t=t||e,o[0]=t[0],o[1]=t[1],o[2]=t[2],_wl_object_transformVectorWorld(this.objectId,l),e[0]=o[0],e[1]=o[1],e[2]=o[2],e}transformVectorLocal(e,t){return t=t||e,o[0]=t[0],o[1]=t[1],o[2]=t[2],_wl_object_transformVectorLocal(this.objectId,l),e[0]=o[0],e[1]=o[1],e[2]=o[2],e}transformPointWorld(e,t){return t=t||e,o[0]=t[0],o[1]=t[1],o[2]=t[2],_wl_object_transformPointWorld(this.objectId,l),e[0]=o[0],e[1]=o[1],e[2]=o[2],e}transformPointLocal(e,t){return t=t||e,o[0]=t[0],o[1]=t[1],o[2]=t[2],_wl_object_transformPointLocal(this.objectId,l),e[0]=o[0],e[1]=o[1],e[2]=o[2],e}transformVectorInverseWorld(e,t){return t=t||e,o[0]=t[0],o[1]=t[1],o[2]=t[2],_wl_object_transformVectorInverseWorld(this.objectId,l),e[0]=o[0],e[1]=o[1],e[2]=o[2],e}transformVectorInverseLocal(e,t){return t=t||e,o[0]=t[0],o[1]=t[1],o[2]=t[2],_wl_object_transformVectorInverseLocal(this.objectId,l),e[0]=o[0],e[1]=o[1],e[2]=o[2],e}transformPointInverseWorld(e,t){return t=t||e,o[0]=t[0],o[1]=t[1],o[2]=t[2],_wl_object_transformPointInverseWorld(this.objectId,l),e[0]=o[0],e[1]=o[1],e[2]=o[2],e}transformPointInverseLocal(e,t){return t=t||e,o.set(t),_wl_object_transformPointInverseLocal(this.objectId,l),e[0]=o[0],e[1]=o[1],e[2]=o[2],e}toWorldSpaceTransform(e,t){return t=t||e,o.set(t),_wl_object_toWorldSpaceTransform(this.objectId,l),e[0]=o[0],e[1]=o[1],e[2]=o[2],e[3]=o[3],e[4]=o[4],e[5]=o[5],e[6]=o[6],e[7]=o[7],e}toLocalSpaceTransform(e,t){let n=this.parent;return t=t||e,n?n.toObjectSpaceTransform(t):e!==t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7]),e}toObjectSpaceTransform(e,t){return t=t||e,o.set(t),_wl_object_toObjectSpaceTransform(this.objectId,l),e[0]=o[0],e[1]=o[1],e[2]=o[2],e[3]=o[3],e[4]=o[4],e[5]=o[5],e[6]=o[6],e[7]=o[7],e}lookAt(e,t=Oe){_wl_object_lookAt(this.objectId,e[0],e[1],e[2],t[0],t[1],t[2])}destroy(){_wl_scene_remove_object(this.objectId),this.objectId=null}setDirty(){_wl_object_set_dirty(this.objectId)}set active(e){let t=this.getComponents();for(let n of t)n.active=e}getComponent(e,t){let n=te(e)?e:e.TypeName,r=lengthBytesUTF8(n)+1,s=_malloc(r);stringToUTF8(n,s,r);let _=_wl_get_component_manager_index(s);if(_free(s),_<0){let m=_WL._componentTypeIndices[n],c=_wl_get_js_component_index(this.objectId,m,t||0);return c<0?null:_WL._components[c]}let a=_wl_get_component_id(this.objectId,_,t||0);return B(n,_,a)}getComponents(e){let t=null,n=null;e&&(n=te(e)?e:e.TypeName,t=h._typeIndexFor(n));let r=[],s=Math.floor(f/3*2),_=_wl_object_get_components(this.objectId,l,s),a=2*_;_wl_object_get_component_types(this.objectId,l+a,s);let m=h._typeIndexFor("js");for(let c=0;c<_;++c){let u=we[c+a],d=N[c];if(u==m){let j=_WL._components[_wl_get_js_component_index_for_id(d)];(t===null||j.type==n)&&r.push(j);continue}if(t===null){let j=h._typeNameFor(u);r.push(B(j,u,d))}else u==t&&r.push(B(n,t,d))}return r}addComponent(e,t){let n=te(e)?e:e.TypeName,r=h._typeIndexFor(n),s=null,_=null;if(r<0){if(!(n in _WL._componentTypeIndices))throw new TypeError("Unknown component type '"+n+"'");let a=_wl_object_add_js_component(this.objectId,_WL._componentTypeIndices[n]);_=_wl_get_js_component_index_for_id(a),s=_WL._components[_]}else{let a=_wl_object_add_component(this.objectId,r);s=B(n,r,a)}if(t!==void 0)for(let a in t)Se.includes(a)||(s[a]=t[a]);return r<0&&_wljs_component_init(_),(!t||!("active"in t&&!t.active))&&(s.active=!0),s}get changed(){return!!_wl_object_is_changed(this.objectId)}equals(e){return e?this.objectId==e.objectId:!1}static _typeIndexFor(e){let t=lengthBytesUTF8(e)+1,n=_malloc(t);stringToUTF8(e,n,t);let r=_wl_get_component_manager_index(n);return _free(n),r}static _typeNameFor(e){return UTF8ToString(_wl_component_manager_name(e))}},ee=class{constructor(e){this._index=e}get jointCount(){return _wl_skin_get_joint_count(this._index)}get jointIds(){return new Uint16Array(HEAPU16.buffer,_wl_skin_joint_ids(this._index),this.jointCount)}get inverseBindTransforms(){return new Float32Array(HEAPF32.buffer,_wl_skin_inverse_bind_transforms(this._index),8*this.jointCount)}get inverseBindScalings(){return new Float32Array(HEAPF32.buffer,_wl_skin_inverse_bind_scalings(this._index),3*this.jointCount)}};var G=class{constructor(e){assert((e&3)==0,Fe),this._ptr=e}get locations(){let e=this._ptr,t=[];for(let n=0;n<this.hitCount;++n)t.push(new Float32Array(HEAPF32.buffer,e+12*n,3));return t}get normals(){let e=this._ptr+48,t=[];for(let n=0;n<this.hitCount;++n)t.push(new Float32Array(HEAPF32.buffer,e+12*n,3));return t}get distances(){let e=this._ptr+48*2;return new Float32Array(HEAPF32.buffer,e,this.hitCount)}get objects(){let e=this._ptr+(48*2+16),t=new Uint16Array(HEAPU16.buffer,e,this.hitCount);return[t[0]<=0?null:w(t[0]),t[1]<=0?null:w(t[1]),t[2]<=0?null:w(t[2]),t[3]<=0?null:w(t[3])]}get hitCount(){return Math.min(HEAPU32[this._ptr/4+30],4)}},Ce=class{static cubicHermite(e,t,n,r,s,_){o.subarray(0).set(t),o.subarray(4).set(n),o.subarray(8).set(r),o.subarray(12).set(s);let a=t.length==4;return _wl_math_cubicHermite(l+4*16,l+4*0,l+4*4,l+4*8,l+4*12,_,a),e[0]=o[16],e[1]=o[17],e[2]=o[18],a&&(e[3]=o[19]),e}};function te(i){return i&&(typeof i=="string"||i.constructor===String)}function w(i){let e=$[i]||($[i]=new h(i));return e.objectId=i,e}function B(i,e,t){if(t<0)return null;let n=M[e]||(M[e]=[]);if(n[t])return n[t];let r;if(i=="collision")r=new Z(e,t);else if(i=="text")r=new Y(e,t);else if(i=="view")r=new D(e,t);else if(i=="mesh")r=new q(e,t);else if(i=="input")r=new Q(e,t);else if(i=="light")r=new J(e,t);else if(i=="animation")r=new K(e,t);else if(i=="physx")r=new P(e,t);else{let s=_WL._componentTypeIndices[i],_=_WL._componentTypes[s];r=new _}return r._manager=e,r._id=t,n[t]=r,r}function Ve(){return R(this,null,function*(){let[i,e]=yield Promise.all([me(),pe()]);return i?console.log("WASM SIMD is supported"):console.warn("WASM SIMD is not supported"),e?self.crossOriginIsolated?console.log("WASM Threads is supported"):console.warn("WASM Threads is supported, but the page is not crossOriginIsolated, therefore thread support is disabled."):console.warn("WASM Threads is not supported"),e=e&&self.crossOriginIsolated,{simdSupported:i,threadsSupported:e}})}function Me(t){return R(this,arguments,function*(i,e={}){let{simdSupported:n,threadsSupported:r}=yield Ve(),{simd:s=n,threads:_=r,physx:a=!1,loader:m=!1}=e,c=`${i}${m?"-loader":""}${a?"-physx":""}${s?"-simd":""}${_?"-threads":""}`,u=yield fetch(c+".wasm");if(!u.ok)return Promise.reject("Failed to fetch runtime .wasm file");let d=yield u.arrayBuffer();return new Promise((j,Te)=>{window.Module={worker:`${c}.worker.js`,wasm:d},window.Module.ready=function(){window._wl_application_start(),j()};let V=document.createElement("script");V.type="text/javascript",V.src=`${c}.js`,V.onerror=function(){Te("Failed to fetch runtime .js file")},document.body.append(V)})})}return Be;})();
//# sourceMappingURL=wonderland.min.js.map
